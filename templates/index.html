<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mushroom AI - Hệ thống dự đoán độc tính</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

  <div class="container">
    <h1><i class="fas fa-microscope"></i> Mushroom AI</h1>
    <p class="subtitle">Sử dụng giải thuật <strong>Random Forest</strong> để phân tích độ an toàn của nấm</p>

    <form id="predict-form">
      <div class="form-grid">
        <div class="form-group">
          <label for="cap-diameter"><i class="fas fa-ruler-horizontal"></i> Đường kính mũ (cm)</label>
          <input type="number" step="0.01" id="cap-diameter" name="cap-diameter" placeholder="Ví dụ: 15.26" required>
        </div>

        <div class="form-group">
          <label for="cap-shape"><i class="fas fa-shapes"></i> Hình dạng mũ</label>
          <select id="cap-shape" name="cap-shape">
            <option value="x">Hình lồi (Convex)</option>
            <option value="f">Hình phẳng (Flat)</option>
            <option value="p">Hình chóp (Spherical)</option>
            <option value="b">Hình chuông (Bell)</option>
            <option value="c">Hình nón (Conical)</option>
            <option value="s">Hình lõm (Sunken)</option>
            <option value="o">Khác (Others)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="cap-color"><i class="fas fa-palette"></i> Màu sắc mũ</label>
          <select id="cap-color" name="cap-color">
            <option value="n">Nâu (Brown)</option>
            <option value="e">Đỏ (Red)</option>
            <option value="g">Xám (Gray)</option>
            <option value="r">Xanh lá (Green)</option>
            <option value="w">Trắng (White)</option>
            <option value="y">Vàng (Yellow)</option>
            <option value="p">Hồng (Pink)</option>
            <option value="u">Tím (Purple)</option>
            <option value="b">Vàng nhạt (Buff)</option>
            <option value="l">Xanh lơ (Blue)</option>
            <option value="o">Cam (Orange)</option>
            <option value="k">Đen (Black)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="stem-height"><i class="fas fa-arrows-alt-v"></i> Chiều cao thân (cm)</label>
          <input type="number" step="0.01" id="stem-height" name="stem-height" placeholder="Ví dụ: 16.95" required>
        </div>

        <div class="form-group">
          <label for="stem-width"><i class="fas fa-ruler-combined"></i> Độ rộng thân (mm)</label>
          <input type="number" step="0.01" id="stem-width" name="stem-width" placeholder="Ví dụ: 17.09" required>
        </div>

        <div class="form-group">
          <label for="season"><i class="fas fa-calendar-alt"></i> Mùa vụ</label>
          <select id="season" name="season">
            <option value="a">Mùa Thu (Autumn)</option>
            <option value="u">Mùa Hè (Summer)</option>
            <option value="s">Mùa Xuân (Spring)</option>
            <option value="w">Mùa Đông (Winter)</option>
          </select>
        </div>
      </div>

      <button type="submit" class="btn" id="submit-btn">
        <span id="btn-text">BẮT ĐẦU PHÂN TÍCH</span>
      </button>
    </form>

    <div id="result" class="result-card">
      <div class="res-item">
        <small>Dự đoán của AI:</small>
        <div id="prediction-value">--</div>
      </div>
      
      <div class="res-item" style="margin-top: 15px;">
        <small>Độ tin cậy của mô hình:</small>
        <div id="confidence-value">--</div>
      </div>

      <div class="disclaimer">
        ⚠️ <strong>Lưu ý:</strong> Đây là công cụ dựa trên AI. Tuyệt đối không ăn bất kỳ loại nấm nào dựa trên kết quả này.
      </div>
    </div>

    <div id="error" class="error-card">
      <i class="fas fa-exclamation-circle"></i> <span id="error-message"></span>
    </div>
  </div>

  <script>
    const form = document.getElementById('predict-form');
    const resultCard = document.getElementById('result');
    const errorCard = document.getElementById('error');
    const predictionSpan = document.getElementById('prediction-value');
    const confidenceSpan = document.getElementById('confidence-value');
    const btnText = document.getElementById('btn-text');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Hiệu ứng Loading
      btnText.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ĐANG TÍNH TOÁN...';
      resultCard.style.display = 'none';
      errorCard.style.display = 'none';

      const formData = new FormData(form);

      try {
        const res = await fetch('/predict', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();

        if (data.success) {
          predictionSpan.textContent = data.variety;
          confidenceSpan.textContent = data.confidence;
          
          // Đổi màu theo kết quả
          if (data.variety.includes("ĐỘC")) {
            predictionSpan.style.color = "var(--danger)";
            resultCard.style.borderTop = "4px solid var(--danger)";
          } else {
            predictionSpan.style.color = "var(--primary)";
            resultCard.style.borderTop = "4px solid var(--primary)";
          }
          
          resultCard.style.display = 'block';
        } else {
          document.getElementById('error-message').textContent = data.error;
          errorCard.style.display = 'block';
        }
      } catch (err) {
        document.getElementById('error-message').textContent = 'Không thể kết nối với máy chủ AI.';
        errorCard.style.display = 'block';
      } finally {
        btnText.innerHTML = 'BẮT ĐẦU PHÂN TÍCH';
      }
    });
  </script>
</body>
</html>